<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì¹´ì¸ë“œì› & ë§ˆìŠ¤í„°í”Œë˜ë„ˆ | KINDWON</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <style>
      :root {
        --kindwon-green: #1b5e3e;
        --kindwon-green-light: #2d6e4f;
        --kindwon-green-lighter: #4a9370;
        --kindwon-green-pale: #e8f5e9;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
      }

      .kindwon-gradient {
        background: linear-gradient(135deg, var(--kindwon-green) 0%, var(--kindwon-green-light) 100%);
      }

      .card-premium {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        transition: all 0.3s ease;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .card-premium:hover {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
        transform: translateY(-2px);
      }

      .btn-kindwon {
        background: var(--kindwon-green);
        color: white;
        transition: all 0.3s ease;
      }

      .btn-kindwon:hover {
        background: var(--kindwon-green-light);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(27, 94, 62, 0.3);
      }

      .logo-image {
        height: 36px;
        width: auto;
        object-fit: contain;
      }

      @media (max-width: 640px) {
        .logo-image {
          height: 30px;
        }
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: var(--kindwon-green);
        box-shadow: 0 0 0 3px rgba(27, 94, 62, 0.1);
      }

      .action-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        border: 2px solid transparent;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .action-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        border-color: var(--kindwon-green);
      }

      .action-card i {
        font-size: 3rem;
        margin-bottom: 1rem;
        display: block;
      }

      .status-active {
        background: var(--kindwon-green-pale);
        color: var(--kindwon-green);
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .status-inactive {
        background: #fee;
        color: #dc2626;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .tab-button {
        padding: 0.75rem 1.5rem;
        border-bottom: 3px solid transparent;
        transition: all 0.2s;
        font-weight: 600;
        color: #6b7280;
      }

      .tab-button:hover {
        color: var(--kindwon-green);
      }

      .tab-button.active {
        color: var(--kindwon-green);
        border-bottom-color: var(--kindwon-green);
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Header -->
    <header class="kindwon-gradient text-white shadow-lg sticky top-0 z-50">
      <div class="container mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <img src="https://www.genspark.ai/api/files/s/UmgxPvd3" alt="KINDWON" class="logo-image" onerror="this.style.display='none'" />
            <div class="hidden sm:block w-px h-8 bg-white opacity-30"></div>
            <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight">
              <i class="fas fa-home mr-2"></i>ì¹´ì¸ë“œì› & ë§ˆìŠ¤í„°í”Œë˜ë„ˆ
            </h1>
          </div>
          <nav class="hidden md:flex gap-4">
            <a href="index.html" class="text-white hover:text-gray-200 transition font-medium">
              <i class="fas fa-home mr-1"></i>ê´€ë¦¬ì
            </a>
            <a href="work-log-list.html" class="text-white hover:text-gray-200 transition font-medium">
              <i class="fas fa-list mr-1"></i>ì—…ë¬´ ì¼ì§€ ëª©ë¡
            </a>
            <a href="work-log-create.html" class="text-white hover:text-gray-200 transition font-medium">
              <i class="fas fa-plus-circle mr-1"></i>ì—…ë¬´ ì¼ì§€ ì‘ì„±
            </a>
            <a href="records.html" class="text-white hover:text-gray-200 transition font-medium">
              <i class="fas fa-user-clock mr-1"></i>ì¶œì„ ê¸°ë¡
            </a>
          </nav>
        </div>
      </div>
    </header>

    <!-- Main Menu Cards -->
    <div class="container mx-auto px-4 py-8">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
        <!-- Card 1: ì§ì› ì¶œì„ -->
        <div class="action-card" onclick="window.location.href='scan.html'">
          <i class="fas fa-qrcode" style="color: #3b82f6;"></i>
          <h3 class="text-xl font-bold text-gray-800 mb-2">ì§ì› ì¶œì„</h3>
          <p class="text-gray-600 text-sm">QR ì½”ë“œ ìŠ¤ìº”í•˜ê¸°</p>
        </div>

        <!-- Card 2: ì¶œì„ ê¸°ë¡ -->
        <div class="action-card" onclick="window.location.href='records.html'">
          <i class="fas fa-chart-line" style="color: #10b981;"></i>
          <h3 class="text-xl font-bold text-gray-800 mb-2">ì¶œì„ ê¸°ë¡</h3>
          <p class="text-gray-600 text-sm">í†µê³„ ë° ë¦¬ìŠ¤íŠ¸</p>
        </div>

        <!-- Card 3: ì²­ì†Œ ê¸°ë¡ -->
        <div class="action-card" onclick="window.location.href='work-admin.html'">
          <i class="fas fa-broom" style="color: #f97316;"></i>
          <h3 class="text-xl font-bold text-gray-800 mb-2">ì²­ì†Œ ê¸°ë¡</h3>
          <p class="text-gray-600 text-sm">ì—…ë¬´ ê¸°ë¡í•˜ê¸°</p>
        </div>

        <!-- Card 4: ì²­ì†Œ í˜„í™© -->
        <div class="action-card" onclick="window.location.href='work-view.html'">
          <i class="fas fa-tasks" style="color: #a855f7;"></i>
          <h3 class="text-xl font-bold text-gray-800 mb-2">ì²­ì†Œ í˜„í™©</h3>
          <p class="text-gray-600 text-sm">ì‹¤ì‹œê°„ í™•ì¸</p>
        </div>

        <!-- Card 5: ì—…ë¬´ ì¼ì§€ ì‘ì„± -->
        <div class="action-card" onclick="window.location.href='work-log-create.html'" style="background: linear-gradient(135deg, #fff5eb 0%, #fed7aa 100%);">
          <i class="fas fa-file-alt" style="color: #ea580c;"></i>
          <h3 class="text-xl font-bold text-gray-800 mb-2">ì—…ë¬´ ì¼ì§€ ì‘ì„±</h3>
          <p class="text-gray-600 text-sm">ì¼ì¼ ì—…ë¬´ ê¸°ë¡</p>
        </div>

        <!-- Card 6: ì—…ë¬´ ì¼ì§€ ëª©ë¡ -->
        <div class="action-card" onclick="window.location.href='work-log-list.html'" style="background: linear-gradient(135deg, #ede9fe 0%, #c4b5fd 100%);">
          <i class="fas fa-list-alt" style="color: #7c3aed;"></i>
          <h3 class="text-xl font-bold text-gray-800 mb-2">ì—…ë¬´ ì¼ì§€ ëª©ë¡</h3>
          <p class="text-gray-600 text-sm">ì‘ì„±ëœ ì¼ì§€ í™•ì¸</p>
        </div>
      </div>

      <!-- Tabs -->
      <div class="card-premium p-6">
        <div class="flex border-b mb-6 overflow-x-auto">
          <button class="tab-button active" onclick="showTab('employees')">
            <i class="fas fa-users mr-2"></i>ì§ì› ê´€ë¦¬
          </button>
          <button class="tab-button" onclick="showTab('areas')">
            <i class="fas fa-map-marker-alt mr-2"></i>êµ¬ì—­ ê´€ë¦¬
          </button>
          <button class="tab-button" onclick="showTab('qrcodes')">
            <i class="fas fa-qrcode mr-2"></i>QR ì½”ë“œ ìƒì„±
          </button>
          <button class="tab-button" onclick="showTab('access')">
            <i class="fas fa-mobile-alt mr-2"></i>ìŠ¤ìº” í˜ì´ì§€ ì ‘ì†
          </button>
        </div>

        <!-- Tab: ì§ì› ê´€ë¦¬ -->
        <div id="tab-employees" class="tab-content">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <i class="fas fa-user-plus mr-3" style="color: var(--kindwon-green);"></i>ì§ì› ë“±ë¡
          </h2>
          <form id="employeeForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
            <input type="text" id="empName" placeholder="ì´ë¦„" class="p-3 border-2 border-gray-200 rounded-lg transition" required />
            <input
              type="text"
              id="empNumber"
              placeholder="ì§ì›ë²ˆí˜¸"
              class="p-3 border-2 border-gray-200 rounded-lg transition"
              required
            />
            <input type="text" id="empDept" placeholder="ë¶€ì„œ" class="p-3 border-2 border-gray-200 rounded-lg transition" />
            <input type="text" id="empPosition" placeholder="ì§ì±…" class="p-3 border-2 border-gray-200 rounded-lg transition" />
            <input type="tel" id="empContact" placeholder="ì—°ë½ì²˜" class="p-3 border-2 border-gray-200 rounded-lg transition" />
            <button type="submit" class="btn-kindwon px-6 py-3 rounded-lg font-bold shadow-md md:col-span-2 lg:col-span-5">
              <i class="fas fa-plus mr-2"></i>ì§ì› ë“±ë¡
            </button>
          </form>

          <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
            <i class="fas fa-list mr-2"></i>ì§ì› ëª©ë¡
          </h3>
          <div class="overflow-x-auto">
            <table class="w-full bg-white rounded-lg overflow-hidden">
              <thead style="background: var(--kindwon-green-pale);">
                <tr>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ì´ë¦„</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ì§ì›ë²ˆí˜¸</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ë¶€ì„œ</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ì§ì±…</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ì—°ë½ì²˜</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ìƒíƒœ</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="employeeList">
                <tr>
                  <td colspan="7" class="p-8 text-center text-gray-400">ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tab: êµ¬ì—­ ê´€ë¦¬ -->
        <div id="tab-areas" class="tab-content hidden">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <i class="fas fa-map-marked-alt mr-3" style="color: var(--kindwon-green);"></i>êµ¬ì—­ ë“±ë¡
          </h2>
          <form id="areaForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
            <input type="text" id="areaName" placeholder="êµ¬ì—­ ì´ë¦„" class="p-3 border-2 border-gray-200 rounded-lg transition" required />
            <input type="text" id="areaCode" placeholder="ì½”ë“œ" class="p-3 border-2 border-gray-200 rounded-lg transition" />
            <input type="text" id="areaBuilding" placeholder="ê±´ë¬¼/ë™" class="p-3 border-2 border-gray-200 rounded-lg transition" />
            <input type="text" id="areaFloor" placeholder="ì¸µ" class="p-3 border-2 border-gray-200 rounded-lg transition" />
            <input type="text" id="areaDesc" placeholder="ì„¤ëª…" class="p-3 border-2 border-gray-200 rounded-lg transition" />
            <button type="submit" class="btn-kindwon px-6 py-3 rounded-lg font-bold shadow-md md:col-span-2 lg:col-span-5">
              <i class="fas fa-plus mr-2"></i>êµ¬ì—­ ë“±ë¡
            </button>
          </form>

          <h3 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
            <i class="fas fa-list mr-2"></i>êµ¬ì—­ ëª©ë¡
          </h3>
          <div class="overflow-x-auto">
            <table class="w-full bg-white rounded-lg overflow-hidden">
              <thead style="background: var(--kindwon-green-pale);">
                <tr>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">êµ¬ì—­ ì´ë¦„</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ì½”ë“œ</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ê±´ë¬¼/ë™</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ì¸µ</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ì„¤ëª…</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ìƒíƒœ</th>
                  <th class="p-4 text-left font-bold" style="color: var(--kindwon-green);">ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="areaList">
                <tr>
                  <td colspan="7" class="p-8 text-center text-gray-400">êµ¬ì—­ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Tab: QR ì½”ë“œ -->
        <div id="tab-qrcodes" class="tab-content hidden">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <i class="fas fa-qrcode mr-3" style="color: var(--kindwon-green);"></i>êµ¬ì—­ë³„ QR ì½”ë“œ
          </h2>
          <div id="qrcodeList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <p class="text-gray-400 col-span-full text-center py-8">QR ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...</p>
          </div>
        </div>

        <!-- Tab: ìŠ¤ìº” í˜ì´ì§€ ì ‘ì† -->
        <div id="tab-access" class="tab-content hidden">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <i class="fas fa-mobile-alt mr-3" style="color: var(--kindwon-green);"></i>ìŠ¤ìº” í˜ì´ì§€ ì ‘ì† ë°©ë²•
          </h2>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- QR Code for Scan Page -->
            <div class="card-premium p-6 text-center">
              <h3 class="text-lg font-bold text-gray-700 mb-4">
                <i class="fas fa-qrcode mr-2"></i>ğŸ“± ë°©ë²• 1: QR ì½”ë“œë¡œ ì ‘ì†
              </h3>
              <div id="scanPageQR" class="inline-block p-4 bg-white rounded-lg shadow-inner mb-4"></div>
              <p class="text-sm text-gray-600">ìŠ¤ë§ˆíŠ¸í° ì¹´ë©”ë¼ë¡œ ìœ„ QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì„¸ìš”</p>
            </div>

            <!-- URL Direct Access -->
            <div class="card-premium p-6">
              <h3 class="text-lg font-bold text-gray-700 mb-4">
                <i class="fas fa-link mr-2"></i>ğŸ”— ë°©ë²• 2: URL ì§ì ‘ ì ‘ì†
              </h3>
              <div class="bg-gray-50 p-4 rounded-lg border-2 border-gray-200 mb-4">
                <code id="scanPageURL" class="text-sm break-all" style="color: var(--kindwon-green);">ë¡œë”© ì¤‘...</code>
              </div>
              <button
                onclick="copyURL()"
                class="btn-kindwon px-4 py-2 rounded-lg font-bold shadow-md w-full"
              >
                <i class="fas fa-copy mr-2"></i>URL ë³µì‚¬í•˜ê¸°
              </button>
            </div>
          </div>

          <!-- Guide -->
          <div class="mt-8 p-6 rounded-xl" style="background: var(--kindwon-green-pale);">
            <h3 class="text-lg font-bold mb-4" style="color: var(--kindwon-green);">
              <i class="fas fa-lightbulb mr-2"></i>ğŸ’¡ ìŠ¤ìº” í˜ì´ì§€ ì‚¬ìš© ê°€ì´ë“œ
            </h3>
            <ol class="space-y-2 text-gray-700">
              <li class="flex items-start gap-2">
                <span class="font-bold" style="color: var(--kindwon-green);">1ï¸âƒ£</span>
                <span>ìŠ¤ìº” í˜ì´ì§€ ì ‘ì† â†’ ë³¸ì¸ ì´ë¦„ ì„ íƒ</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="font-bold" style="color: var(--kindwon-green);">2ï¸âƒ£</span>
                <span>ì¹´ë©”ë¼ ê¶Œí•œ í—ˆìš©</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="font-bold" style="color: var(--kindwon-green);">3ï¸âƒ£</span>
                <span>êµ¬ì—­ QR ì½”ë“œ ì´¬ì˜</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="font-bold" style="color: var(--kindwon-green);">4ï¸âƒ£</span>
                <span>ì¶œì„ ì²´í¬ ì™„ë£Œ!</span>
              </li>
            </ol>
            <div class="mt-4 p-4 bg-white rounded-lg">
              <p class="text-sm text-gray-600 font-semibold">ğŸ’¡ íŒ:</p>
              <ul class="text-sm text-gray-600 mt-2 space-y-1">
                <li>â€¢ ìŠ¤ìº” í˜ì´ì§€ë¥¼ í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ë©´ ì•±ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                <li>â€¢ í•œ ë²ˆ ì ‘ì†í•˜ë©´ ë‹¤ìŒì—ë„ ì‰½ê²Œ ì ‘ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                <li>â€¢ ì—¬ëŸ¬ êµ¬ì—­ì„ ì—°ì†ìœ¼ë¡œ ìŠ¤ìº”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Tab Switching
      function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach((el) => el.classList.add('hidden'));
        document.querySelectorAll('.tab-button').forEach((el) => el.classList.remove('active'));

        document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        event.target.classList.add('active');

        if (tabName === 'qrcodes') generateQRCodes();
        if (tabName === 'access') generateScanPageQR();
      }

      // Employee Form Submit
      document.getElementById('employeeForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const employeeData = {
          name: document.getElementById('empName').value,
          employee_number: document.getElementById('empNumber').value,
          department: document.getElementById('empDept').value,
          position: document.getElementById('empPosition').value,
          contact: document.getElementById('empContact').value,
          status: 'active',
        };

        const { error } = await supabase.from('employees').insert(employeeData);
        if (error) {
          alert('ë“±ë¡ ì‹¤íŒ¨: ' + error.message);
        } else {
          alert('âœ… ì§ì›ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
          document.getElementById('employeeForm').reset();
          loadEmployees();
        }
      });

      // Area Form Submit
      document.getElementById('areaForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const areaData = {
          name: document.getElementById('areaName').value,
          code: document.getElementById('areaCode').value,
          building: document.getElementById('areaBuilding').value,
          floor: document.getElementById('areaFloor').value,
          description: document.getElementById('areaDesc').value,
          status: 'active',
        };

        const { error } = await supabase.from('locations').insert(areaData);
        if (error) {
          alert('ë“±ë¡ ì‹¤íŒ¨: ' + error.message);
        } else {
          alert('âœ… êµ¬ì—­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
          document.getElementById('areaForm').reset();
          loadAreas();
        }
      });

      // Load Employees
      async function loadEmployees() {
        const { data, error } = await supabase.from('employees').select('*').order('created_at', { ascending: false });

        const tbody = document.getElementById('employeeList');
        if (error || !data || data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          return;
        }

        tbody.innerHTML = data
          .map(
            (emp) => `
          <tr class="border-b hover:bg-gray-50 transition">
            <td class="p-4 font-semibold text-gray-800">${emp.name}</td>
            <td class="p-4 text-gray-600">${emp.employee_number}</td>
            <td class="p-4 text-gray-600">${emp.department || '-'}</td>
            <td class="p-4 text-gray-600">${emp.position || '-'}</td>
            <td class="p-4 text-gray-600">${emp.contact || '-'}</td>
            <td class="p-4">
              <span class="${emp.status === 'active' ? 'status-active' : 'status-inactive'}">
                ${emp.status === 'active' ? 'í™œì„±' : 'ì‚­ì œ'}
              </span>
            </td>
            <td class="p-4">
              <button onclick="deleteEmployee('${emp.id}')" class="text-red-400 hover:text-red-600 transition font-semibold">
                <i class="fas fa-trash"></i> ì‚­ì œ
              </button>
            </td>
          </tr>
        `,
          )
          .join('');
      }

      // Load Areas
      async function loadAreas() {
        const { data, error } = await supabase.from('locations').select('*').order('created_at', { ascending: false });

        const tbody = document.getElementById('areaList');
        if (error || !data || data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">ë“±ë¡ëœ êµ¬ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          return;
        }

        tbody.innerHTML = data
          .map(
            (area) => `
          <tr class="border-b hover:bg-gray-50 transition">
            <td class="p-4 font-semibold text-gray-800">${area.name}</td>
            <td class="p-4 text-gray-600">${area.code || '-'}</td>
            <td class="p-4 text-gray-600">${area.building || '-'}</td>
            <td class="p-4 text-gray-600">${area.floor || '-'}</td>
            <td class="p-4 text-gray-600">${area.description || '-'}</td>
            <td class="p-4">
              <span class="${area.status === 'active' ? 'status-active' : 'status-inactive'}">
                ${area.status === 'active' ? 'í™œì„±' : 'ì‚­ì œ'}
              </span>
            </td>
            <td class="p-4">
              <button onclick="deleteArea('${area.id}')" class="text-red-400 hover:text-red-600 transition font-semibold">
                <i class="fas fa-trash"></i> ì‚­ì œ
              </button>
            </td>
          </tr>
        `,
          )
          .join('');
      }

      // Generate QR Codes
      async function generateQRCodes() {
        const { data, error } = await supabase.from('locations').select('*').eq('status', 'active');

        const container = document.getElementById('qrcodeList');
        if (error || !data || data.length === 0) {
          container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-8">ë“±ë¡ëœ êµ¬ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }

        container.innerHTML = data
          .map(
            (area) => `
          <div class="card-premium p-6 text-center">
            <h3 class="font-bold text-lg mb-3" style="color: var(--kindwon-green);">${area.name}</h3>
            <div id="qr-${area.id}" class="inline-block"></div>
            <button onclick="downloadQR('qr-${area.id}', '${area.name}')" class="mt-4 btn-kindwon px-4 py-2 rounded-lg text-sm font-bold w-full">
              <i class="fas fa-download mr-2"></i>ë‹¤ìš´ë¡œë“œ
            </button>
          </div>
        `,
          )
          .join('');

        // Generate QR codes
        data.forEach((area) => {
          const qrContainer = document.createElement('canvas');
          document.getElementById(`qr-${area.id}`).appendChild(qrContainer);
          QRCode.toCanvas(
            qrContainer,
            JSON.stringify({ location_id: area.id, location_name: area.name }),
            { width: 200 },
          );
        });
      }

      // Generate Scan Page QR
      function generateScanPageQR() {
        const scanURL = window.location.origin + '/scan.html';
        document.getElementById('scanPageURL').innerText = scanURL;

        const qrContainer = document.getElementById('scanPageQR');
        qrContainer.innerHTML = '';
        const canvas = document.createElement('canvas');
        qrContainer.appendChild(canvas);
        QRCode.toCanvas(canvas, scanURL, { width: 200 });
      }

      // Copy URL
      function copyURL() {
        const url = document.getElementById('scanPageURL').innerText;
        navigator.clipboard.writeText(url).then(() => alert('âœ… URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'));
      }

      // Download QR
      function downloadQR(canvasId, name) {
        const canvas = document.querySelector(`#${canvasId} canvas`);
        const url = canvas.toDataURL('image/png');
        const a = document.createElement('a');
        a.href = url;
        a.download = `QR_${name}.png`;
        a.click();
      }

      // Delete Employee
      async function deleteEmployee(id) {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        const { error } = await supabase.from('employees').update({ status: 'deleted' }).eq('id', id);
        if (error) alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
        else {
          alert('âœ… ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
          loadEmployees();
        }
      }

      // Delete Area
      async function deleteArea(id) {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        const { error } = await supabase.from('locations').update({ status: 'deleted' }).eq('id', id);
        if (error) alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
        else {
          alert('âœ… ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
          loadAreas();
        }
      }

      // Initialize
      loadEmployees();
      loadAreas();
    </script>
  </body>
</html>
